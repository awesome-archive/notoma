---

title: Notoma

keywords: fastai
sidebar: home_sidebar

summary: "Write articles for any static gen blog, in Notion."
description: "Write articles for any static gen blog, in Notion."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notoma is a small tool that works with your Notion database and allows you to turn your Notion pages into a blog, or a website — with any static gen website engine and hosting platform you want.</p>
<p>Notoma is available as a stand alone CLI app, and a Python library. You can use it locally to prepare and preview your articles and commit them, or as a part of your remote build pipeline.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Imports-and-dependencies">Imports and dependencies<a class="anchor-link" href="#Imports-and-dependencies"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Config">Config<a class="anchor-link" href="#Config"> </a></h2><p>Where will we store configuration, including sensitive data like auth tokens, and blog db name?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps Notoma&#39;s settings in an object with easier access.</span>
<span class="sd">    Settings are loaded from `.env` file, and from the system environment.</span>
<span class="sd">    You can override them by providing kwargs when creating an instance of a config.</span>

<span class="sd">    `.env` keys are explicit and long, i.e. `NOTOMA_NOTION_TOKEN_V2`. `kwargs` key responsible for the token is just</span>
<span class="sd">    `token_v2`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads config from a `.env` file or system environment.</span>

<span class="sd">        You can provide any kwargs you want and they would override environment config values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">load_dotenv</span><span class="p">(</span><span class="n">find_dotenv</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">token_v2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NOTOMA_NOTION_TOKEN_V2&#39;</span><span class="p">),</span>
                               <span class="n">blog_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NOTOMA_NOTION_BLOG_URL&#39;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">token_v2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="s1">&#39;token_v2&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">blog_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="s1">&#39;blog_url&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Config" class="doc_header"><code>class</code> <code>Config</code><a href="https://github.com/xnutsive/notoma/tree/master/notoma/core.py#L15" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Config</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Wraps Notoma's settings in an object with easier access.
Settings are loaded from <code>.env</code> file, and from the system environment.
You can override them by providing kwargs when creating an instance of a config.</p>
<p><code>.env</code> keys are explicit and long, i.e. <code>NOTOMA_NOTION_TOKEN_V2</code>. <code>kwargs</code> key responsible for the token is just
<code>token_v2</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Notion-Client">Notion Client<a class="anchor-link" href="#Notion-Client"> </a></h2><p>Provides a thin wrapper around <code>notion-py</code> — an API wrapper library for the reverse-engineered Notion API. Pagify users that client to grab the blog contents from Notion.</p>
<p>The client utilizes authentication token from Notion's web version, <code>token_v2</code>, that you can grab from your browers cookies.</p>
<blockquote><p>Notice:This token authorizes any code to do anything that you can do in the browser in Notion on your behalf, so don't share it publicly, and don't store it your code or git.</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">notion_client</span><span class="p">(</span><span class="n">token_v2</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NotionClient</span><span class="p">:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">NotionClient</span><span class="p">(</span><span class="n">token_v2</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">token_v2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">client</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="notion_client" class="doc_header"><code>notion_client</code><a href="https://github.com/xnutsive/notoma/tree/master/notoma/core.py#L53" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>notion_client</code>(<strong><code>token_v2</code></strong>:<code>str</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">notion_client</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">token_v2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Blog-Database">Blog Database<a class="anchor-link" href="#Blog-Database"> </a></h2><p>Build a helper that would take the client, search for the provided DB name, and return it, or error out if notfound.</p>
<p>Build a function that returns an iterator over all the pages in that database.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">notion_blog_database</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">NotionClient</span><span class="p">,</span> <span class="n">db_url</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns a Notion database, wraped into a `notion.Collection` for easy access to it&#39;s rows.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">get_collection_view</span><span class="p">(</span><span class="n">db_url</span><span class="p">)</span><span class="o">.</span><span class="n">collection</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="notion_blog_database" class="doc_header"><code>notion_blog_database</code><a href="https://github.com/xnutsive/notoma/tree/master/notoma/core.py#L58" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>notion_blog_database</code>(<strong><code>client</code></strong>:<code>NotionClient</code>, <strong><code>db_url</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Returns a Notion database, wraped into a <code>notion.Collection</code> for easy access to it's rows.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">blog</span> <span class="o">=</span> <span class="n">notion_blog_database</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">blog_url</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Page-Structure">Page Structure<a class="anchor-link" href="#Page-Structure"> </a></h2><p>Build a class or a function that takes the notion page object (from the iterator) and can return the metadata values, and iterate over it's contents.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>Page</code> is a record in the Blog database. Here's the format that Pagify expects:</p>
<ul>
<li><p>Page title will be converted to the .md file name. File name will be formatted with dashes instead of spaces, and the page udpated at date will be uppended in YYYY-MM-DD format.</p>
</li>
<li><p>Published: an optional boolean field. If present, Pagify will ignore pages where published: false.</p>
</li>
<li><p>Description: if the Page text starts with a word Desciption, then the whole first paragraph is considered description, and will be added to the markdown file front matter (metadata).</p>
</li>
<li><p>Publish at: a datetime field, if present, will be used as published at front matter key in the md file.</p>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">page</span> <span class="o">=</span> <span class="n">blog</span><span class="o">.</span><span class="n">get_rows</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">page</span><span class="o">.</span><span class="n">title</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Notoma First Article&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Converting-Page-to-Markdown">Converting Page to Markdown<a class="anchor-link" href="#Converting-Page-to-Markdown"> </a></h2><p>Build a quick conversion of a Notion page to a .md file</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="block2md" class="doc_header"><code>block2md</code><a href="https://github.com/xnutsive/notoma/tree/master/notoma/core.py#L63" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>block2md</code>(<strong><code>block</code></strong>:<code>Block</code>, <strong><code>counter</code></strong>:<code>int</code>=<em><code>1</code></em>)</p>
</blockquote>
<p>Transforms a Notion Block into a Markdown string.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="page2md" class="doc_header"><code>page2md</code><a href="https://github.com/xnutsive/notoma/tree/master/notoma/core.py#L103" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>page2md</code>(<strong><code>page</code></strong>:<code>PageBlock</code>)</p>
</blockquote>
<p>Translates a Notion Page (<code>PageBlock</code>) into a Markdown string.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="page2path" class="doc_header"><code>page2path</code><a href="https://github.com/xnutsive/notoma/tree/master/notoma/core.py#L121" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>page2path</code>(<strong><code>page</code></strong>:<code>PageBlock</code>, <strong><code>dest_dir</code></strong>:<code>Path</code>=<em><code>PosixPath('.')</code></em>)</p>
</blockquote>
<p>Build a .md file path in <code>dest_dir</code> based on a Notion page metadata.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="page_front_matter" class="doc_header"><code>page_front_matter</code><a href="https://github.com/xnutsive/notoma/tree/master/notoma/core.py#L126" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>page_front_matter</code>(<strong><code>page</code></strong>:<code>PageBlock</code>)</p>
</blockquote>
<p>Builds a page front matter in a yaml-like format.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Converting-multiple-pages">Converting multiple pages<a class="anchor-link" href="#Converting-multiple-pages"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">notion2md</span><span class="p">(</span><span class="n">token_v2</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">database_url</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grab Notion Blog database using auth token `token_v2`,</span>
<span class="sd">    convert posts in database `database_url` to Markdown, and save them to `dest`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">notion_client</span><span class="p">(</span><span class="n">token_v2</span><span class="p">)</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">notion_blog_database</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">database_url</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">get_rows</span><span class="p">():</span>
        <span class="n">page2path</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">dest_dir</span><span class="o">=</span><span class="n">dest</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">page2md</span><span class="p">(</span><span class="n">page</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="notion2md" class="doc_header"><code>notion2md</code><a href="https://github.com/xnutsive/notoma/tree/master/notoma/core.py#L138" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>notion2md</code>(<strong><code>token_v2</code></strong>:<code>str</code>, <strong><code>database_url</code></strong>:<code>str</code>, <strong><code>dest</code></strong>:<code>Union</code>[<code>str</code>, <code>Path</code>])</p>
</blockquote>
<p>Grab Notion Blog database using auth token <code>token_v2</code>,
convert posts in database <code>database_url</code> to Markdown, and save them to <code>dest</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

